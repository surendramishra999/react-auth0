{"ast":null,"code":"import _classCallCheck from \"/mnt/d/projects/react-auth0/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/mnt/d/projects/react-auth0/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport auth0 from 'auth0-js';\nvar ROLE_URL = \"http://localhost:3000/roles\";\n\nvar Auth =\n/*#__PURE__*/\nfunction () {\n  function Auth(history) {\n    var _this = this;\n\n    _classCallCheck(this, Auth);\n\n    this.login = function () {\n      _this.auth0.authorize();\n    };\n\n    this.handleAuthentication = function () {\n      _this.auth0.parseHash(function (err, authResult) {\n        if (authResult && authResult.accessToken && authResult.idToken) {\n          _this.setSession(authResult);\n\n          _this.history.push('/');\n        } else if (err) {\n          _this.history.push('/');\n\n          alert(\"Error :\".concat(err.error, \". Check console log for more details\"));\n          console.log(err);\n        }\n      });\n    };\n\n    this.setSession = function (authResult) {\n      //set expire time\n      var expireAt = JSON.stringify(authResult.expiresIn * 1000 + new Date().getTime());\n      var scope = authResult.scope || _this.requestedScope || '';\n      console.log(\"&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&\");\n      console.log(authResult.idTokenPayload.idTokenPayload.ROLE_URL);\n      localStorage.setItem('access_token', authResult.accessToken);\n      localStorage.setItem('id_token', authResult.idToken);\n      localStorage.setItem('roles', JSON.stringify(authResult.idTokenPayload.idTokenPayload[ROLE_URL]));\n      localStorage.setItem('expire_at', expireAt);\n      localStorage.setItem('scopes', JSON.stringify(scope));\n    };\n\n    this.logout = function () {\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('id_token');\n      localStorage.removeItem('expire_at');\n      localStorage.removeItem('scopes');\n      localStorage.removeItem('roles');\n      _this.userProfile = null;\n\n      _this.auth0.logout({\n        clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n        returnTo: \"http://localhost:3000/\"\n      });\n\n      _this.history.push('/');\n    };\n\n    this.getAccessToken = function () {\n      var accessToken = localStorage.getItem(\"access_token\");\n\n      if (!accessToken) {\n        throw new Error(\"No Access Token found\");\n      }\n\n      return accessToken;\n    };\n\n    this.getProfile = function (cb) {\n      if (_this.userProfile) return cb(_this.userProfile);\n\n      _this.auth0.client.userInfo(_this.getAccessToken(), function (error, userProfile) {\n        if (userProfile) _this.userProfile = userProfile;\n        cb(userProfile, error);\n      });\n    };\n\n    this.userHasScopes = function (scopes) {\n      var grantedScopes = (JSON.parse(localStorage.getItem('scopes')) || \"\").split(\" \");\n      return scopes.every(function (scope) {\n        return grantedScopes.includes(scope);\n      });\n    };\n\n    this.checkRole = function (role) {\n      console.log(\"***********************\");\n      console.log(localStorage.getItem('roles'));\n      var roles = JSON.parse(localStorage.getItem('roles')) || [];\n      console.log(roles);\n      return roles.includes(role);\n    };\n\n    this.history = history;\n    this.requestedScope = \"openid profile email read:courses\";\n    this.auth0 = new auth0.WebAuth({\n      domain: process.env.REACT_APP_AUTH0_DOMAIN,\n      clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n      redirectUri: process.env.REACT_APP_AUTH0_CALLBACK_URL,\n      audience: process.env.REACT_APP_AUTH0_AUDIENCE,\n      responseType: \"token id_token\",\n      scope: this.requestedScope\n    });\n  }\n\n  _createClass(Auth, [{\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      var expireAt = JSON.parse(localStorage.getItem('expire_at'));\n      return new Date().getTime() < expireAt;\n    }\n  }]);\n\n  return Auth;\n}();\n\nexport { Auth as default };","map":{"version":3,"sources":["/mnt/d/projects/react-auth0/src/Auth/Auth.js"],"names":["auth0","ROLE_URL","Auth","history","login","authorize","handleAuthentication","parseHash","err","authResult","accessToken","idToken","setSession","push","alert","error","console","log","expireAt","JSON","stringify","expiresIn","Date","getTime","scope","requestedScope","idTokenPayload","localStorage","setItem","logout","removeItem","userProfile","clientID","process","env","REACT_APP_AUTH0_CLIENT_ID","returnTo","getAccessToken","getItem","Error","getProfile","cb","client","userInfo","userHasScopes","scopes","grantedScopes","parse","split","every","includes","checkRole","role","roles","WebAuth","domain","REACT_APP_AUTH0_DOMAIN","redirectUri","REACT_APP_AUTH0_CALLBACK_URL","audience","REACT_APP_AUTH0_AUDIENCE","responseType"],"mappings":"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","sourcesContent":["import auth0 from 'auth0-js';\r\nconst ROLE_URL=\"http://localhost:3000/roles\";\r\nexport default class Auth{\r\n  constructor(history){\r\n   this.history=history;\r\n   this.requestedScope=\"openid profile email read:courses\";\r\n   this.auth0=new auth0.WebAuth({\r\n       domain:process.env.REACT_APP_AUTH0_DOMAIN,\r\n       clientID:process.env.REACT_APP_AUTH0_CLIENT_ID,\r\n       redirectUri:process.env.REACT_APP_AUTH0_CALLBACK_URL,\r\n       audience:process.env.REACT_APP_AUTH0_AUDIENCE,\r\n       responseType:\"token id_token\",\r\n       scope:this.requestedScope\r\n   });\r\n  }\r\n\r\n  login =()=>{\r\n    this.auth0.authorize();\r\n  }\r\n\r\n  handleAuthentication=()=>{\r\n    this.auth0.parseHash((err,authResult)=>{\r\n      if(authResult && authResult.accessToken && authResult.idToken){\r\n         this.setSession(authResult);\r\n         this.history.push('/');\r\n      }else if(err){\r\n        this.history.push('/');\r\n        alert(`Error :${err.error}. Check console log for more details`);\r\n        console.log(err);\r\n      }\r\n    });\r\n  }\r\n\r\n  setSession=authResult=>{\r\n    //set expire time\r\n    const expireAt=JSON.stringify(\r\n      authResult.expiresIn * 1000 + new Date().getTime()\r\n      );\r\n      const scope=authResult.scope || this.requestedScope || '';\r\n      console.log(\"&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&\");\r\n      console.log(authResult.idTokenPayload.idTokenPayload.ROLE_URL);\r\n      localStorage.setItem('access_token',authResult.accessToken);\r\n      localStorage.setItem('id_token',authResult.idToken);\r\n      localStorage.setItem('roles',JSON.stringify(authResult.idTokenPayload.idTokenPayload[ROLE_URL]));\r\n      localStorage.setItem('expire_at',expireAt);\r\n      localStorage.setItem('scopes',JSON.stringify(scope));\r\n  }\r\n\r\n  isAuthenticated(){\r\n    const expireAt=JSON.parse(localStorage.getItem('expire_at'));\r\n    return new Date().getTime()<expireAt;\r\n  }\r\n\r\n  logout=()=>{\r\n    localStorage.removeItem('access_token');\r\n    localStorage.removeItem('id_token');\r\n    localStorage.removeItem('expire_at');\r\n    localStorage.removeItem('scopes');\r\n    localStorage.removeItem('roles');\r\n    this.userProfile=null;\r\n    this.auth0.logout({\r\n      clientID:process.env.REACT_APP_AUTH0_CLIENT_ID,\r\n      returnTo:\"http://localhost:3000/\"\r\n    });\r\n    this.history.push('/');\r\n  }\r\n\r\n  getAccessToken=()=>{\r\n    const accessToken=localStorage.getItem(\"access_token\");\r\n    if(!accessToken){\r\n     throw new Error(\"No Access Token found\");\r\n    }\r\n    return accessToken;\r\n  }\r\n\r\n  getProfile=cb=>{\r\n   if(this.userProfile) return cb(this.userProfile);\r\n   this.auth0.client.userInfo(this.getAccessToken(),(error,userProfile)=>{\r\n     if(userProfile) this.userProfile=userProfile;\r\n     cb(userProfile,error);\r\n   });\r\n\r\n  }\r\n\r\n  userHasScopes=(scopes)=>{\r\n   const grantedScopes=(\r\n     JSON.parse(localStorage.getItem('scopes'))|| \"\"\r\n   ).split(\" \");\r\n   return scopes.every(scope=>grantedScopes.includes(scope));\r\n  }\r\n\r\n  checkRole=(role)=>{\r\n    console.log(\"***********************\");\r\n    console.log(localStorage.getItem('roles'));\r\n    const roles=(\r\n      JSON.parse(localStorage.getItem('roles'))|| []\r\n    );\r\n    console.log(roles);\r\n    return roles.includes(role);\r\n   }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}